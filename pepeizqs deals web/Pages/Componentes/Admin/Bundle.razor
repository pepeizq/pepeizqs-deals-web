@using Microsoft.AspNetCore.Components.Web;
@using Microsoft.Data.SqlClient
@using Newtonsoft.Json

<div style="padding: 20px; background: var(--fondoCuerpo); margin-bottom: 50px;">
	<div style="display: flex; align-items: center; margin-bottom: 20px;">
		<div style="width: 100%;">
			Admin Editar • @bundle.NombreBundle
		</div>
	</div>
	
	<div style="display: flex; align-items: center;">
		<div style="width: 15%; padding-right: 20px; text-align: right;">
			Nombre
		</div>

		<div style="width: 85%;">
			<textarea @onchange="(e => TextoCambiaNombre(e))" class="entrada-texto" rows="1">@textoNombre</textarea>
		</div>	
	</div>
</div>

@code {

    #nullable disable

    [Parameter]
    public string idioma { get; set; }

    [Parameter]
    public int bundleId { get; set; }

    public Bundles2.Bundle bundle = new Bundles2.Bundle();

    private string textoNombre = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(10);

        bundle = BaseDatos.Bundles.Buscar.UnBundle(bundleId);

        textoNombre = bundle.NombreBundle;
	}

	private void TextoCambiaNombre(ChangeEventArgs texto)
	{
		if (string.IsNullOrEmpty(texto.Value.ToString().Trim()) == false)
		{
			string nuevoTexto = texto.Value.ToString().Trim();

			SqlConnection conexion = Herramientas.BaseDatos.Conectar();

			using (conexion)
			{
				BaseDatos.Bundles.Actualizar.Nombre(bundleId.ToString(), nuevoTexto, conexion);
			}
		}
	}
}
