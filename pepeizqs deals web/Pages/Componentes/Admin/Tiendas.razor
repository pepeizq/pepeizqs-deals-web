@using Microsoft.AspNetCore.Components.Web;
@using Microsoft.AspNetCore.Identity
@using pepeizqs_deals_web.Areas.Identity.Data
@using Tiendas2

@inject UserManager<Usuario> UserManager
@inject IHttpContextAccessor HttpContextAccessor

@if (BaseDatos.Usuarios.Buscar.RolDios(UserManager.GetUserName(HttpContextAccessor.HttpContext.User)) == true)
{
	<div class="perfil perfil-espacio-bottom" style="padding: 25px 40px;">
		@foreach (Tienda tienda in TiendasCargar.GenerarListado())
		{
			@if (tienda.AdminEnseñar == true)
			{
				<div class="perfil-flexible-centrado" style="margin-top: 15px; margin-bottom: 15x;">
					<div style="width: 50%;">
						@if (tienda.AdminInteractuar == true)
						{
							<button @onclick="@(e => ClickearTienda(e, tienda.Id))" class="boton-pequeño admin-boton-imagen-300x80" style="background-image: url(@tienda.Imagen300x80);"></button>
						}
						else
						{
							<div class="boton-pequeño admin-boton-imagen-300x80" style="background-image: url(@tienda.Imagen300x80); background-color: transparent;"></div>
						}
					</div>
					<div style="width: 50%; padding-left: 30px;">
						<div class="admin-tiempohace">@BaseDatos.Tiendas.Admin.ComprobacionMensaje(tienda.Id)</div>
					</div>
				</div>
			}
		}
	</div>

	<div class="perfil perfil-espacio-bottom">
		<form method="post">
			<div class="perfil-flexible-centrado">
				<div style="width: 25%;">
					<button class="boton-pequeño" style="text-align: center;" id="divisas" asp-route-id="divisas" type="submit">Actualizar</button>
				</div>
				<div style="width: 75%; padding-left: 20px;">
					<div class="admin-tiempohace">@Herramientas.Divisas.Mensaje()</div>
				</div>
			</div>
		</form>
	</div>
}


@code {

	private void ClickearTienda(MouseEventArgs e, string id)
	{
		if (id != null)
		{
			if (id.Length > 0)
			{
				if (id == APIs.Steam.Tienda.Generar().Id)
				{
					APIs.Steam.Tienda.BuscarOfertas(true);
				}
				else if (id == APIs.GamersGate.Tienda.Generar().Id)
				{
					APIs.GamersGate.Tienda.BuscarOfertas();
				}
				else if (id == APIs.Gamesplanet.Tienda.GenerarUk().Id)
				{
					APIs.Gamesplanet.Tienda.BuscarOfertasUk();
				}
				else if (id == APIs.Gamesplanet.Tienda.GenerarFr().Id)
				{
					APIs.Gamesplanet.Tienda.BuscarOfertasFr();
				}
				else if (id == APIs.Gamesplanet.Tienda.GenerarDe().Id)
				{
					APIs.Gamesplanet.Tienda.BuscarOfertasDe();
				}
				else if (id == APIs.Gamesplanet.Tienda.GenerarUs().Id)
				{
					APIs.Gamesplanet.Tienda.BuscarOfertasUs();
				}
				else if (id == APIs.Fanatical.Tienda.Generar().Id)
				{
					APIs.Fanatical.Tienda.BuscarOfertas();
				}
				else if (id == APIs.GreenManGaming.Tienda.Generar().Id)
				{
					APIs.GreenManGaming.Tienda.BuscarOfertas();
				}

				if (id == "divisas")
				{
					Herramientas.Divisas.Ejecutar();
				}

				///Admin/Tiendas?id=limpiar&tienda=

				if (id == "limpiar")
				{
					//BaseDatos.Juegos.Precios.Limpiar(tienda);
				}
			}
		}
	}

}
